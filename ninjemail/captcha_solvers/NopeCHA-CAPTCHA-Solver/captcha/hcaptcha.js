(()=>{var k=chrome;var D="https://api.nopecha.com",m="https://www.nopecha.com",Y="https://developers.nopecha.com",Ee={doc:{url:Y,automation:{url:`${Y}/guides/extension_advanced/#automation-build`}},api:{url:D,recognition:{url:`${D}/recognition`},status:{url:`${D}/status`}},www:{url:m,annoucement:{url:`${m}/json/announcement.json`},demo:{url:`${m}/demo`,hcaptcha:{url:`${m}/demo/hcaptcha`},recaptcha:{url:`${m}/demo/recaptcha`},funcaptcha:{url:`${m}/demo/funcaptcha`},awscaptcha:{url:`${m}/demo/awscaptcha`},turnstile:{url:`${m}/demo/turnstile`},textcaptcha:{url:`${m}/demo/textcaptcha`},perimeterx:{url:`${m}/demo/perimeterx`}},manage:{url:`${m}/manage`},pricing:{url:`${m}/pricing`},setup:{url:`${m}/setup`}},discord:{url:`${m}/discord`},github:{url:`${m}/github`,release:{url:`${m}/github/release`}}};function Q(e){let t=("6146a541f7b2046020e84d44aa2e1e120f2ad8b75ac9b6fc236f65f737a7006f"+e).split("").map(n=>n.charCodeAt(0));return j(t)}var V=new Uint32Array(256);for(let e=256;e--;){let t=e;for(let n=8;n--;)t=t&1?3988292384^t>>>1:t>>>1;V[e]=t}function j(e){let t=-1;for(let n of e)t=t>>>8^V[t&255^n];return(t^-1)>>>0}async function h(e,t){let n=""+[+new Date,performance.now(),Math.random()],[a,r]=await new Promise(i=>{k.runtime.sendMessage([n,e,...t],i)});if(a===Q(n))return r}function I(){let e;return t=>e||(e=t().finally(()=>e=void 0),e)}var ke=I(),v;function J(){return ke(async()=>(v||(v=await h("settings::get",[])),v))}function G(e){v&&(v={...v,...e},Z(v))}function B(){return v}function p(e){return new Promise(t=>setTimeout(t,e))}var ee=[];function E(e,t){e.timedout=!1,ee.push(e);let n,a=setInterval(async()=>{await te(e,B())||(clearTimeout(n),clearInterval(a))},400);t&&(n=setTimeout(()=>clearInterval(a),t),e.timedout=!0)}async function te(e,t){if(e.timedout)return!1;let n=e.condition(t);if(n===e.running())return!1;if(!n&&e.running())return e.quit(),!1;if(n&&!e.running()){for(;!e.ready();)await p(200);return e.start(),!1}}function Z(e){ee.forEach(t=>te(t,e))}function ne(){k.runtime.connect({name:"stream"}).onMessage.addListener(t=>{t.event==="settingsUpdate"&&G(t.settings)})}function R(e){if(document.readyState!=="loading")setTimeout(e,0);else{let t;t=()=>{removeEventListener("DOMContentLoaded",t),e()},addEventListener("DOMContentLoaded",t)}}var nt=I();var Se=(e,t,n)=>new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t,screenY:n,clientX:t,clientY:n,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});function y(e,{events:t=null,x:n=null,y:a=null}={}){let r=document.querySelector(e);if(!r)return;if(n===null||a===null){let o=r.getBoundingClientRect();n=o.left+o.width/2,a=o.top+o.height/2}let i=t??["mouseover","mousedown","mouseup","click"];for(let o of i)r.dispatchEvent(Se(o,n,a))}function ae(e,t){return Math.random()*(t-e)+e}function P(e,t,n,a){let r=new MouseEvent(t,{bubbles:!0,cancelable:!0,clientX:n,clientY:a});e.dispatchEvent(r)}function oe(e,t,n,a,r,i=10,o=10,c=2){return new Promise(s=>{let d=document.querySelector(e);if(!d)return;let l=d.getBoundingClientRect();P(d,"mousedown",t+l.left,n+l.top);for(let u=1;u<=i;u++){let g=u/i,w=t+(a-t)*g,b=n+(r-n)*g,x=ae(-c,c),A=ae(-c,c);setTimeout(()=>{P(d,"mousemove",w+x+l.left,b+A+l.top)},u*o)}setTimeout(()=>{P(d,"mouseup",a+l.left,r+l.top),s()},i*o)})}var M,q=!1;function re(){return!!(document.querySelector("div.check")&&document.querySelector("#anchor"))}function ie(){q=!0;let e=document.querySelector("div.check"),t=document.querySelector("#anchor"),n=()=>{e.style.display==="block"||t.getAttribute("aria-hidden")=="true"||Ce()};M=new MutationObserver(n),M.observe(e,{attributes:!0}),M.observe(t,{attributes:!0}),n()}function se(){M.disconnect(),q=!1}function ce(){return q}async function Ce(){await p(400),y("#checkbox")}function S(e,t){let n=document.createElement("canvas");return n.width=e,n.height=t,n}function le(e){return new Promise((t,n)=>{let a=new Image;a.onload=()=>t(a),a.onerror=r=>n(r),a.src=`data:image/png;base64,${e}`})}function N(e){return e.toDataURL("image/jpeg").replace(/data:image\/[a-z]+;base64,/g,"")}function Te(e){try{e.getContext("2d").getImageData(0,0,1,1)}catch{return!0}return!1}async function O(e,t,n=1e4){if(!t&&!e.complete&&!await new Promise(o=>{let c=setTimeout(()=>{o(!1)},n);e.addEventListener("load",()=>{clearTimeout(c),o(!0)})}))return;let a=S(e.naturalWidth||t?.clientWidth,e.naturalHeight||t?.clientHeight);return a.getContext("2d").drawImage(e,0,0),!Te(a)&&a}async function ue(e){let n=getComputedStyle(e).backgroundImage;if(!n||n==="none")if("src"in e&&e.src)n=`url("${e.src}")`;else return;if("computedStyleMap"in e){let s=e.computedStyleMap().get("background-image");if(s instanceof CSSImageValue){let d=await O(s,e);if(d)return d}}let a=/"(.+)"/.exec(n);if(!a)return;n=a[1];let r=document.createElement("a");if(r.href=n,new URL(r.href).origin===document.location.origin){let s=new Image;s.crossOrigin="anonymous",s.src=n;let d=await O(s);if(d)return d}let i=await h("fetch::asData",[n,{}]),o=new Image;o.crossOrigin="anonymous",o.src=i.data;let c=await O(o);if(c)return c}function de(e,t,n,a){let r=(a*t+n)*4;return[e[r],e[r+1],e[r+2]]}function me(e,t){return e.every(n=>n<=t)}function ge(e,t){return e.every(n=>n>=t)}function z(e,t=0,n=230,a=.99){let r=e.getContext("2d"),i=r.canvas.width,o=r.canvas.height;if(i===0||o===0)return!0;let c=r.getImageData(0,0,i,o).data,s=0;for(let l=0;l<o;l++)for(let u=0;u<i;u++){let g=de(c,i,u,l);(me(g,t)||ge(g,n))&&s++}return s/(i*o)>a}function pe(e,t=0,n=230,a=.1){let r=e.getContext("2d"),i=r.canvas.width,o=r.canvas.height,c=r.getImageData(0,0,i,o).data,s=Array(o).fill(0),d=Array(i).fill(0);for(let f=0;f<o;f++)for(let _=0;_<i;_++){let X=de(c,i,_,f);(me(X,t)||ge(X,n))&&(s[f]++,d[_]++)}let l=s.map((f,_)=>f/i<1-a?_:null).filter(f=>f!==null),u=d.map((f,_)=>f/o<1-a?_:null).filter(f=>f!==null);if(l.length===0||u.length===0)return{croppedCanvas:e,coordinates:[0,0,i-1,o-1]};let g=l[0],w=l[l.length-1],b=u[0],x=u[u.length-1];if(x-b+1===1||w-g+1===1)return{croppedCanvas:null,coordinates:[0,0,0,0]};let A=r.getImageData(b,g,x-b+1,w-g+1),K=S(x-b+1,w-g+1);return K.getContext("2d").putImageData(A,0,0),{croppedCanvas:K,coordinates:[b,g,x,w]}}function U(e,t=500,n=500){let a=e.getContext("2d"),r=a.canvas.width,i=a.canvas.height,o=a.getImageData(0,0,r,i),c=o.width,s=o.height,d=c/s,l=c,u=s;if(l>t&&(l=t,u=Math.floor(l/d)),u>n&&(u=n,l=Math.floor(u*d)),l===c&&u===s)return e;let g=S(c,s);g.getContext("2d").putImageData(o,0,0);let b=S(l,u);return b.getContext("2d").drawImage(g,0,0,c,s,0,0,l,u),b}function fe(){return[]}function he(e){return new Promise(t=>{e.push(t)})}function L(e){e.forEach(t=>t()),e.splice(0)}async function be(e,t){let n={v:k.runtime.getManifest().version,key:Ie(e)};return n.url=await h("tab::getURL",[]),n}function Ie(e){return!e.keys||!e.keys.length?e.key:e.keys[Math.floor(Math.random()*e.keys.length)]}var H=fe(),$,T=!1;function _e(){let e=document.querySelector(".challenge-container");return!(!e||e.childElementCount===0||!document.querySelector(".display-error")||!document.querySelector("body.no-selection")||!document.querySelector("div.button-submit.button"))}function ve(){T=!0,L(H),$=new MutationObserver(async()=>{setTimeout(()=>L(H),200)}),$.observe(document.querySelector(".display-error"),{attributes:!0,attributeFilter:["aria-hidden"]}),$.observe(document.querySelector("div.button-submit.button"),{attributes:!0,attributeFilter:["style"]}),Ae()}function we(){$.disconnect(),T=!1,L(H)}function xe(){return T}async function Be(){document.querySelector(".display-language .text").textContent!=="EN"&&y(".language-selector .option:nth-child(23)")}async function C(e,t){let n=await ue(t);if(n&&!z(n))return e!==null&&(n=U(n,e,e)),N(n)}function F(){let e=document.querySelector("h2.prompt-text");if(e)return e.textContent.replace(/\s+/g," ").trim()}function W(){return new URLSearchParams(location.hash.substring(1)).get("sitekey")}var Me={[0]:{async getTask(){let e=F();if(!e)return;let t=[...document.querySelectorAll(".task-image")];if(t.length!==9)return;let n=(await Promise.all(t.map(i=>i.querySelector("div.image")).filter(i=>i).map(C.bind(this,128)))).filter(i=>i);if(n.length!==9)return;let a=[...document.querySelectorAll(".examples .image")],r=(await Promise.all(a.map(C.bind(this,128)))).filter(i=>i);return{cells:t,payload:{type:"hcaptcha",task:e,sitekey:W(),image_data:n,image_examples:r}}},async solution({cells:e},t){e.forEach((n,a)=>{let r=n.getAttribute("aria-pressed")=="true";t.data[a]!==r&&y(`.task:nth-child(${a+1})`)})}},[1]:{async getTask(){let e=F();if(!e)return;let t=document.querySelector(".task-image .image");if(!t)return;let n=await C(500,t);if(!n)return;let a=[...document.querySelectorAll(".challenge-answer")];if(a.length<2)return;let r=a.map(o=>o.querySelector(".text-content")?.textContent);if(r.some(o=>!o))return;let i=(await Promise.all(a.map(o=>o.querySelector("div.image")).filter(o=>o).map(C.bind(this,128)))).filter(o=>o);return{payload:{type:"hcaptcha_multiple_choice",task:e,sitekey:W(),image_data:[n],choices:r,image_choices:i}}},async solution(e,t){let n;Array.isArray(t.data)?n=t.data[0]:n=t.data;let a=e.payload.choices.indexOf(n);y(`.challenge-answer:nth-child(${a+1})`)}},[2]:{async getTask(){let e=F();if(!e)return;let t=document.querySelector(".challenge-view > canvas");if(!t||z(t))return;let{croppedCanvas:n,coordinates:a}=pe(t);if(!n)return;let r=U(n,500,500);if(!r)return;let i=N(r),o=[...document.querySelectorAll(".example-image .image")],c=(await Promise.all(o.map(C.bind(this,128)))).filter(s=>s);return{coordinates:a,payload:{type:"hcaptcha_area_select",task:e,sitekey:W(),image_data:[i],image_examples:c}}},async solution(e,t){let{x:n,y:a,w:r,h:i}=t.data,o=document.querySelector(".challenge-view > canvas"),c=e.coordinates,s=c[2]-c[0],d=c[3]-c[1];n=n/100*s+c[0],a=a/100*d+c[1],r=r/100*s,i=i/100*d;let l=o?+o.style.width.replace("px","")/+o.width:1,u=o?+o.style.height.replace("px","")/+o.height:1;r&&i?await oe(".challenge-view > canvas",n*l,a*u,(n+r)*l,(a+i)*u):y(".challenge-view > canvas",{events:["mousedown","mousemove","mouseup"],x:n*l,y:a*u})}}},Le=[[".challenge-view > .task-grid",0],[".challenge-view > .task-wrapper",1],[".challenge-view > .bounding-box-example",2]];function $e(){return Le.filter(([e])=>document.querySelector(e)).map(([e,t])=>t)[0]}async function He(e){if(e.payload.type==="hcaptcha_area_select"&&"image_data"in e.payload&&Array.isArray(e.payload.image_data)&&e.payload.image_data.length===1){let t=e.payload.image_data[0],a=S(500,500).getContext("2d"),r=await le(t);a.drawImage(r,0,0);let i=10,o=a.getImageData(0,0,500,i);return JSON.stringify({task:e.payload.task,top:o})}return JSON.stringify(e)}var ye=!1;async function Ae(){if(ye)return;ye=!0;let e;for(;T;){if(document.querySelector(".display-error[aria-hidden=false]"))for(;document.querySelector(".button-submit[title*=Submit], .button-submit[title*=Verify]");)await p(1e3);if(!document.querySelector(".challenge-container")?.childElementCount){await p(1e3);continue}await Be(),await p(500);let t,n,a=!1;for(let s=0;s<30&&T;s++){s&&await p(1e3);let d=$e();if(d!==void 0&&(t=Me[d],n=await t.getTask(),n)){let l=await He(n);if(e&&l===e)continue;e=l,a=!0;break}}if(!n||!a){y(".refresh"),await p(2e3);continue}let r=B(),i=new Date().valueOf(),o=await h("api::recognition",[{...n.payload,...await be(r)}]);if(!o||"error"in o){await p(2e3);continue}let c=new Date().valueOf();if(r.hcaptcha_solve_delay){let s=r.hcaptcha_solve_delay_time-c+i;s>0&&await p(s)}await t.solution(n,o),await p(200),y(".button-submit"),await he(H),await p(200)}}async function De(){ne(),await J(),await h("tab::registerDetectedCaptcha",["hcaptcha"]);let e=new URLSearchParams(location.hash.substring(1)),t=e.get("frame"),n=e.get("host");t==="checkbox"?E({name:"hcaptcha/auto-open",condition:a=>a.enabled&&a.hcaptcha_auto_open&&!a.disabled_hosts.includes(n),ready:re,start:ie,quit:se,running:ce}):E({name:"hcaptcha/auto-solve",condition:a=>a.enabled&&a.hcaptcha_auto_solve&&!a.disabled_hosts.includes(n),ready:_e,start:ve,quit:we,running:xe})}R(De);})();
